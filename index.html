<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>1kgアナログはかり（単体HTML版）</title>
<style>
  :root{--ink:#0b1220; --muted:#5b6477; --brand:#2563eb; --line:#e4e9f3}
  *{box-sizing:border-box}
  body{margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic",sans-serif; background:#f6f8fb; color:var(--ink)}
  .wrap{max-width:1000px; margin:24px auto; padding:0 16px}
  h1{font-size:22px; margin:0 0 12px 0; text-align:center}
  .card{background:#fff; border:1px solid var(--line); border-radius:14px; padding:16px; box-shadow:0 2px 10px rgba(0,0,0,.03); display:flex; justify-content:center}
  .row{display:flex; flex-wrap:wrap; gap:10px; margin-top:12px; justify-content:center}
  button{appearance:none; border:none; border-radius:999px; padding:10px 14px; font-weight:700; cursor:pointer; box-shadow:inset 0 0 0 1px #d6dbe6; background:#f3f5f9}
  button.primary{background:var(--brand); color:#fff; box-shadow:none}
  .shadow{filter: drop-shadow(0 2px 6px rgba(0,0,0,.12));}
  .note{font-size:12px; color:var(--muted); text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <h1>1kgアナログはかり</h1>
    <div class="card">
      <svg id="scaleSvg" viewBox="0 0 420 420" width="420" height="420" class="shadow">
        <circle cx="210" cy="210" r="208" fill="#fff" stroke="#2d6cdf" stroke-width="10"/>
        <circle cx="210" cy="210" r="190" fill="#ffffff" />
        <g id="ticks" stroke="#333"></g>
        <g id="labels" fill="#333" font-weight="700"></g>
        <g id="needle" transform="rotate(0 210 210)">
          <g id="needleHit" style="cursor: grab">
            <polygon points="198,234 222,234 218,125 214,78 210,48 206,78 202,125"
              fill="#e53935" stroke="#b91c1c" stroke-width="2" />
            <circle cx="210" cy="210" r="11" fill="#fff" stroke="#555" stroke-width="3"/>
          </g>
        </g>
      </svg>
    </div>
    <div class="row">
      <button class="primary" id="rnd10">ランダム(10g)</button>
      <button class="primary" id="rnd100">ランダム(100g)</button>
      <button id="toZero">0にもどす</button>
      <button id="toggleAns">答えを表示</button>
    </div>
    <div id="readout" style="margin-top:10px; font-weight:800; text-align:center">現在：???</div>
    <p class="note">針をドラッグ/スワイプで回せます。単体で動作します。</p>
  </div>
<script>
(function(){
  const svg = document.getElementById('scaleSvg');
  const ticksGroup = document.getElementById('ticks');
  const labelsGroup = document.getElementById('labels');
  const needle = document.getElementById('needle');
  const hit = document.getElementById('needleHit');
  const readout = document.getElementById('readout');
  const btn10 = document.getElementById('rnd10');
  const btn100 = document.getElementById('rnd100');
  const btnZero = document.getElementById('toZero');
  const btnToggle = document.getElementById('toggleAns');

  const r=190,cx=210,cy=210; let grams=0; let answerHidden=true; let dragging=false;

  function valueToAngle(g){return (g/1000)*360;}
  function polar(radius,deg){const rad=((deg-90)*Math.PI)/180;return {x:cx+radius*Math.cos(rad),y:cy+radius*Math.sin(rad)};}
  function clamp(v,min,max){return Math.max(min,Math.min(max,v));}

  for(let g=0;g<=1000;g+=5){
    const deg=valueToAngle(g);
    const is200=g%200===0;const is100=g%100===0;const is50=g%50===0;const is10=g%10===0;
    const len=is200?26:is100?22:is50?16:is10?10:5;
    const p1=polar(r-6,deg),p2=polar(r-6-len,deg);
    const line=document.createElementNS("http://www.w3.org/2000/svg","line");
    line.setAttribute("x1",p1.x);line.setAttribute("y1",p1.y);
    line.setAttribute("x2",p2.x);line.setAttribute("y2",p2.y);
    line.setAttribute("stroke-width",(is200||is100)?3:1);
    ticksGroup.appendChild(line);
  }

  // Labels
  function label(val,text,size,weight,radius){
    const pos=polar(radius??(r-58),valueToAngle(val));
    const t=document.createElementNS("http://www.w3.org/2000/svg","text");
    t.setAttribute("x",pos.x);t.setAttribute("y",pos.y);
    t.setAttribute("font-size",size);t.setAttribute("font-weight",weight);
    t.setAttribute("text-anchor","middle");t.setAttribute("dominant-baseline","middle");
    t.textContent=text;labelsGroup.appendChild(t);
  }
  label(0,"0",16,700,r+25);label(1000,"1000g",22,800,r-60);
  [100,200,300,400,500,600,700,800,900].forEach(v=>label(v,v+"g",20,800));
  [50].forEach(v=>label(v,v+"g",14,600,r-40));
  [150,250,350,450,550,650,750,850,950].forEach(v=>label(v,v,14,600,r-40));

  function setGrams(g){grams=clamp(Math.round(g/5)*5,0,1000);
    needle.setAttribute("transform",`rotate(${valueToAngle(grams)} ${cx} ${cy})`);render();}
  function render(){readout.textContent="現在："+(answerHidden?"???":grams+" g");
    btnToggle.textContent=answerHidden?"答えを表示":"答えを隠す";}

  function onMove(e){if(!dragging)return;
    const rect=svg.getBoundingClientRect();
    const rad=Math.atan2(e.clientY-(rect.top+rect.height/2),e.clientX-(rect.left+rect.width/2));
    let deg=rad*180/Math.PI;deg=(deg+90+360)%360;
    setGrams((deg/360)*1000);}
  function start(e){dragging=true;e.target.setPointerCapture?.(e.pointerId);}
  function stop(){dragging=false;}
  hit.addEventListener("pointerdown",start);
  window.addEventListener("pointermove",onMove);
  window.addEventListener("pointerup",stop);

  function spinTo(t){t=clamp(Math.round(t/5)*5,0,1000);
    const start=grams,diff=(t-start+1000)%1000,back=1000-diff;
    const dir=diff<=back?5:-5,total=diff<=back?diff:back;
    const steps=Math.max(18,total/5),int=600/steps;let i=0;
    const id=setInterval(()=>{i++;setGrams((grams+dir+1000)%1000);
      if(i>=steps){clearInterval(id);setGrams(t);}},int);}

  btn10.addEventListener("click",()=>spinTo(Math.floor(Math.random()*101)*10));
  btn100.addEventListener("click",()=>spinTo(Math.floor(Math.random()*11)*100));
  btnZero.addEventListener("click",()=>setGrams(0));
  btnToggle.addEventListener("click",()=>{answerHidden=!answerHidden;render();});

  setGrams(0);
})();</script>
</body>
</html>